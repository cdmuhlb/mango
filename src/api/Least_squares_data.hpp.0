#ifndef MANGO_LEAST_SQUARES_DATA_H
#define MANGO_LEAST_SQUARES_DATA_H

#include "mango.hpp"

namespace mango {

  class Problem_data;

  // This class contains ugly implementation details that are specific to least-squares minimization
  class Least_squares_data {
    // Everything is public because this information must be used by the concrete Package.
  public:
    int N_terms;
    double* targets;
    double* sigmas;
    residual_function_type residual_function;
    double* best_residual_function;
    double* residuals;
    bool print_residuals_in_output_file;

    Least_squares_data(int);
    ~Least_squares_data();

    void optimize(Problem_data*);
    void group_leaders_least_squares_loop();
    double residuals_to_single_objective(double*);
    void residual_function_wrapper(const double*, double*, bool*);
    static void least_squares_to_single_objective(int*, const double*, double*, int*, mango::MPI_Partition*, void*);
    void finite_difference_Jacobian(const double*, double*, double*);
    void finite_difference_Jacobian_to_gradient(const double*, double*, double*);
  }
}

#endif
